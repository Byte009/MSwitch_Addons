#NAME Fader
#HELP Beschreibungstext
#V 2.03a_Test
#VS V2.00
#S .Trigger_cmd_on -> (mode:Fade|mode:RGB|mode:Spektral|rgb:.*|Zeit:.*)
#S .sortby -> show
#S last_activation_by -> event
#S .Trigger_condition -> 
#S .Trigger_off -> no_trigger
#S last_cmd -> 1
#S .Device_Events -> (mode:Fade[bs]mode:RGB[bs]mode:Spektral[bs]rgb:.*[bs]Zeit:.*) no_trigger
#S .V_Check -> V2.00
#S .Device_Affected_Details -> FreeCmd-AbsCmd1#[NF]cmd#[NF]cmd#[NF]{;;my $rgb;;;my ($r, $g, $b) = (int(rand(256)), int(rand(256)), int(rand(256)));;;$rgb = sprintf("%02x%02x%02x", $r, $g, $b);;;my $aktrgb = ReadingsVal( '$SELF', 'nextrgb', 'FFFFFF' );;;fhem("setreading $SELF nextrgb $rgb ");;;fhem("setreading $SELF aktrgb $aktrgb");;;my $devtoswitch = AttrVal( $name, 'DeviceToSwitch', 'no_device' );;;my $transitiontime = AttrVal( $name, 'Transitiontime', 1 );;;;;fhem("set $devtoswitch rgb $aktrgb [$SELF:Zeit]") if ('[$SELF:changergb]' eq 'timer');;;fhem("set $devtoswitch rgb $aktrgb $transitiontime") if ('[$SELF:changergb]' eq 'transitiontime');;;fhem("set $devtoswitch rgb $aktrgb") if ('[$SELF:changergb]' eq 'immediately');;;;;};;#[NF]#[NF]delay1#[NF]delay1#[NF]00:00:00#[NF]00:00:00#[NF][$SELF:mode] eq "Fade"#[NF]#[NF]0#[NF]0#[NF]1#[NF]1#[NF]setze zufallsfarbe#[NF]0#[NF]0#[NF]1#[ND]FreeCmd-AbsCmd2#[NF]cmd#[NF]cmd#[NF]{;;fhem("set $SELF mode Fade");;;}#[NF]{;;fhem("set $SELF wait 2");;;fhem("set $SELF del_delays");;;fhem("set $SELF mode off");;;my $devtoswitch = AttrVal( '$SELF', 'DeviceToSwitch', 'no_device' );;;fhem("set $devtoswitch off");;;fhem("deletereading $SELF todo.*");;;fhem("deletereading $SELF waiting");;;}#[NF]delay1#[NF]delay1#[NF]00:00:00#[NF]00:00:00#[NF]#[NF]#[NF]0#[NF]0#[NF]1#[NF]0#[NF]abschalten des devices#[NF]0#[NF]0#[NF]8#[ND]FreeCmd-AbsCmd3#[NF]cmd#[NF]cmd#[NF]{;;my $devtoswitch = AttrVal( $name, 'DeviceToSwitch', 'no_device' );;;fhem("set $devtoswitch rgb [$SELF:rgb]");;;}#[NF]#[NF]delay1#[NF]delay1#[NF]00:00:00#[NF]00:00:00#[NF]#[NF]#[NF]0#[NF]0#[NF]1#[NF]4#[NF]setzt farbe bei event rgb:FARBE#[NF]0#[NF]0#[NF]4#[ND]FreeCmd-AbsCmd4#[NF]cmd#[NF]cmd#[NF]{;;my $change = 1;;;my $rot;;;my $gruen;;;my $blau;;;my $rgb;;;my $count;;; ;;for($count=0;$count<=255;$count=$count + $change );;{;;$gruen = sprintf ("%02x", $count);;;$rgb .= sprintf "FF${gruen}00 ";;;};;for($count=255;$count>=0;$count=$count - $change );;{;;$rot = sprintf ("%02x", $count);;;$rgb .= sprintf "${rot}FF00 ";;;};;for($count=0;$count<=255;$count=$count + $change);;{;;$blau = sprintf ("%02x", $count);;;$rgb .= sprintf "00FF${blau} ";;;};;for($count=255;$count>=0;$count=$count - $change );;{;;$gruen = sprintf ("%02x", $count);;;$rgb .= sprintf "00${gruen}FF ";;;};;for($count=0;$count<=255;$count=$count + $change );;{;;$rot = sprintf ("%02x", $count);;;$rgb .= sprintf "${rot}00FF ";;;};;;;my @a = split(" ",$rgb);;;my $anz = @a;;;$anz=$anz-1;;;fhem("setreading $SELF todo $rgb");;;fhem("setreading $SELF todoanz $anz");;;fhem("setreading $SELF todofirst 1");;;fhem("set $SELF exec_cmd_1 ID 6");;;}#[NF]#[NF]delay1#[NF]delay1#[NF]00:00:00#[NF]00:00:00#[NF]#[NF]#[NF]0#[NF]0#[NF]1#[NF]5#[NF]#[NF]0#[NF]0#[NF]9#[ND]FreeCmd-AbsCmd5#[NF]cmd#[NF]cmd#[NF]{;;my $test;;;my @test1;;;my $akttodo;;;my $kommand ;;;my $kommand1 ;;;$test = ReadingsVal( '$SELF', 'todo', '' );;;$akttodo = ReadingsVal( '$SELF', 'todofirst', '' );;;@test1 = split(' ',$test); ;;my $farbe = $test1[$akttodo];;;my $devtoswitch = AttrVal( $name, 'DeviceToSwitch', 'no_device' );;;my $transitiontime = AttrVal( $name, 'Transitiontime', 2 );;;fhem("set $devtoswitch rgb $farbe [$SELF:Zeit]") if ('[$SELF:changergb]' eq 'timer');;;fhem("set $devtoswitch rgb $farbe $transitiontime") if ('[$SELF:changergb]' eq 'transitiontime');;;fhem("set $devtoswitch rgb $farbe") if ('[$SELF:changergb]' eq 'immediately');;;fhem("setreading $SELF aktrgb $farbe");;;;;$akttodo++;;;readingsSingleUpdate( $hash, "todofirst", "$akttodo", 0 );;;if (ReadingsVal( '$SELF', 'todoanz', '' ) < $akttodo);;{;;readingsSingleUpdate( $hash, "todofirst", 1, 0 );;;};;}#[NF]#[NF]delay1#[NF]delay1#[NF]00:00:00#[NF]00:00:00#[NF]#[NF]#[NF]0#[NF]0#[NF]1#[NF]6#[NF]#[NF]0#[NF]0#[NF]10#[ND]MSwitch_Self-AbsCmd1#[NF]mode#[NF]no_action#[NF]RGB#[NF]#[NF]delay0#[NF]delay1#[NF]00:00:01#[NF]00:00:00#[NF][$SELF:mode] ne "Fade" OR ([$SELF:mode] eq "Fade" AND [$SELF:rgb] ne [$SELF:nextrgb] AND [$SELF:rgb] ne [$SELF:aktrgb])#[NF]#[NF]0#[NF]0#[NF]1#[NF]2#[NF]setzt farbe bei event rgb:FARBE#[NF]0#[NF]0#[NF]2#[ND]MSwitch_Self-AbsCmd2#[NF]mode#[NF]no_action#[NF]Fade#[NF]#[NF]delay1#[NF]delay1#[NF]00:00:00#[NF]00:00:00#[NF]#[NF]#[NF]0#[NF]0#[NF]1#[NF]11#[NF]normal id 3#[NF]0#[NF]0#[NF]3#[ND]MSwitch_Self-AbsCmd3#[NF]exec_cmd_1#[NF]no_action#[NF]ID 1#[NF]#[NF]delay1#[NF]delay1#[NF]00:00:01#[NF]00:00:00#[NF]#[NF]#[NF]0#[NF]0#[NF]1#[NF]11#[NF]normal id 3#[NF]0#[NF]0#[NF]3#[ND]MSwitch_Self-AbsCmd4#[NF]aktrgb#[NF]no_action#[NF][$SELF:rgb]#[NF]#[NF]delay1#[NF]delay1#[NF]00:00:00#[NF]00:00:00#[NF]#[NF]#[NF]0#[NF]0#[NF]2#[NF]2#[NF]#[NF]0#[NF]0#[NF]2#[ND]MSwitch_Self-AbsCmd5#[NF]exec_cmd_1#[NF]no_action#[NF]ID 1#[NF]#[NF]delay1#[NF]delay1#[NF][$SELF:Time]#[NF]00:00:00#[NF][$SELF:mode] eq "Fade"#[NF]#[NF]0#[NF]0#[NF]2#[NF]1#[NF]#[NF]0#[NF]0#[NF]1#[ND]MSwitch_Self-AbsCmd6#[NF]exec_cmd_1#[NF]no_action#[NF]ID 6#[NF]#[NF]delay1#[NF]delay1#[NF][$SELF:Time]#[NF]00:00:00#[NF][$SELF:mode] eq "Spektral"#[NF]#[NF]0#[NF]0#[NF]2#[NF]6#[NF]#[NF]0#[NF]0#[NF]11
#S Time -> 00:00:05
#S rgb -> 0000FF
#S mode -> off
#S Trigger_device -> MSwitch_Self
#S EVTPART2 -> last_activation_by
#S EVTPART3 -> event
#S .Trigger_on -> no_trigger
#S .Trigger_cmd_off -> mode:off
#S Trigger_log -> off
#S changergb -> immediately
#S EVTPART1 -> Fader
#S aktrgb -> FF3800
#S EVENT -> last_activation_by:event
#S last_event -> last_activation_by:event
#S .Device_Affected -> FreeCmd-AbsCmd1,FreeCmd-AbsCmd2,FreeCmd-AbsCmd3,FreeCmd-AbsCmd4,FreeCmd-AbsCmd5,MSwitch_Self-AbsCmd1,MSwitch_Self-AbsCmd2,MSwitch_Self-AbsCmd3,MSwitch_Self-AbsCmd4,MSwitch_Self-AbsCmd5,MSwitch_Self-AbsCmd6
#S state -> off
#S Zeit -> 5
#S .Trigger_time -> 
#S .First_init -> done
#S nextrgb -> e09c5c
#S EVTFULL -> Fader:last_activation_by:event
#A MSwitch_Lock_Quickedit -> 1
#A devStateIcon -> {"off.*:FS20.off .*:FS20.on@#".ReadingsVal($name, "aktrgb", "ffffff")}
#A MSwitch_Expert -> 1
#A MSwitch_Extensions -> 0
#A genericDeviceType -> light
#A MSwitch_Ignore_Types -> notify allowed at watchdog doif fhem2fhem telnet FileLog readingsGroup FHEMWEB autocreate eventtypes readingsproxy svg cul
#A Transitiontime -> 1
#A room -> ESPEasy
#A webCmd -> mode:changergb:Zeit:rgb:rgb FF0000:rgb 00FF00:rgb 0000FF:rgb FFFF00:rgb FFA500:rgb 8a2be2
#A MSwitch_Inforoom -> MSwitch
#A readingList -> Zeit rgb mode aktrgb changergb
#A MSwitch_Debug -> 0
#A verbose -> 1
#A MSwitch_Delete_Delays -> 1
#A MSwitch_Comments -> 0
#A userattr -> DeviceToSwitch Transitiontime
#A DeviceToSwitch -> ESP_Lichtkugel,HUEDevice6
#A userReadings -> Time:Zeit.* {#[nl]my $sec = ReadingsVal( $name, "Zeit", 0 );#[nl]my $hours = ( abs($sec) < 3600 ? 0 : int( abs($sec) / 3600 ) );#[nl]my $minutes = ( abs($sec) < 60 ? 0 : int( abs($sec) / 60 ) );#[nl]my $seconds = abs($sec) % 60;#[nl]$hours   = "0" . $hours   if ( $hours < 10 );#[nl]$minutes = "0" . $minutes if ( $minutes < 10 );#[nl]$seconds = "0" . $seconds if ( $seconds < 10 );#[nl]return "$hours:$minutes:$seconds";#[nl]}
#A MSwitch_Include_Webcmds -> 0
#A stateFormat -> mode
#A MSwitch_Event_Id_Distributor -> mode:Fade=>cmd1 ID 1#[nl]mode:Spektral=>cmd1 ID 5#[nl]rgb:.*=>cmd1 ID 2#[nl]Zeit:.*=>cmd1 ID 3#[nl]mode:RGB=>cmd1 ID 4#[nl]
#A setList -> Zeit:slider,1,1,60 rgb:colorpicker,rgb mode:Fade,Spektral,RGB,off aktrgb changergb:transitiontime,timer,immediately
#A MSwitch_Mode -> Full
#A MSwitch_Include_Devicecmds -> 1
#A MSwitch_Include_MSwitchcmds -> 0
#A MSwitch_Help -> 0
#A MSwitch_generate_Events -> 0

#-NEXT-

#NAME Timer
#HELP Beschreibungstext
#V 2.03a_Test
#VS V2.00
#S .Trigger_cmd_on -> no_trigger
#S .Trigger_cmd_off -> no_trigger
#S Timer -> 02:05
#S .Device_Affected_Details -> t2-AbsCmd1#[NF]on#[NF]off#[NF]#[NF]#[NF]delay1#[NF]delay1#[NF]00:00:00#[NF]00:00:00#[NF]#[NF]#[NF]#[NF]#[NF]1#[NF]0
#S timer_state -> no_timer
#S .sysconf -> my#[sp]$hh#[sp]=#[sp]#[st]#[st]#[se]#[nl]my#[sp]$mm#[sp]=#[sp]#[st]#[st]#[se]#[nl]my#[sp]$x#[sp]#[sp]=#[sp]0#[se]#[nl]while#[sp](#[sp]$x#[sp]<#[sp]24#[sp])#[sp]{#[nl]#[sp]#[sp]#[sp]#[sp]my#[sp]$y#[sp]=#[sp]$x#[se]#[nl]#[sp]#[sp]#[sp]#[sp]if#[sp](#[sp]length($y)#[sp]<#[sp]2#[sp])#[sp]{#[sp]$y#[sp]=#[sp]"0"#[sp].#[sp]$y#[se]#[sp]}#[nl]#[sp]#[sp]#[sp]#[sp]$hh#[sp].=#[sp]$y#[sp].#[sp]"#[dp]00#[ko]"#[se]#[nl]#[sp]#[sp]#[sp]#[sp]my#[sp]$z#[sp]=#[sp]5#[se]#[nl]#[sp]#[sp]#[sp]#[sp]while#[sp](#[sp]$z#[sp]<#[sp]60#[sp])#[sp]{#[nl]#[sp]#[sp]#[sp]#[sp]#[sp]#[sp]#[sp]#[sp]my#[sp]$a#[sp]=#[sp]$z#[se]#[nl]#[sp]#[sp]#[sp]#[sp]#[sp]#[sp]#[sp]#[sp]if#[sp](#[sp]length($a)#[sp]<#[sp]2#[sp])#[sp]{#[sp]$a#[sp]=#[sp]"0"#[sp].#[sp]$a#[se]#[sp]}#[nl]#[sp]#[sp]#[sp]#[sp]#[sp]#[sp]#[sp]#[sp]$hh#[sp].=#[sp]$y#[sp].#[sp]"#[dp]"#[sp].#[sp]$a#[sp].#[sp]"#[ko]"#[se]#[nl]#[sp]#[sp]#[sp]#[sp]#[sp]#[sp]#[sp]#[sp]$z#[sp]=#[sp]$z#[sp]+#[sp]5#[se]#[nl]#[sp]#[sp]#[sp]#[sp]}#[nl]#[sp]#[sp]#[sp]#[sp]$x++#[se]#[nl]}#[nl]chop#[sp]$hh#[se]#[nl]$special#[sp]=#[sp]"onHH#[dp]"#[sp].#[sp]$hh#[se]#[nl]#[nl]if#[sp](#[sp]$cmd#[sp]eq#[sp]"Timer_on"#[sp]&&#[sp]ReadingsVal(#[sp]$name#[ko]#[sp]#[st]onHH#[st]#[ko]#[sp]#[st]00#[dp]00#[st]#[sp])#[sp]eq#[sp]"00#[dp]00"#[sp])#[sp]{#[nl]#[sp]#[sp]#[sp]#[sp]$cmd#[sp]=#[sp]"on"#[se]#[nl]}#[nl]#[nl]if#[sp](#[sp]$cmd#[sp]eq#[sp]"Stop"#[sp])#[sp]{#[nl]#[sp]#[sp]#[sp]#[sp]MSwitch_Delete_Delay(#[sp]$hash#[ko]#[sp]#[st]all#[st]#[sp])#[se]#[nl]#[sp]#[sp]#[sp]#[sp]readingsSingleUpdate(#[sp]$hash#[ko]#[sp]"timer_state"#[ko]#[sp]"no_timer"#[ko]#[sp]1#[sp])#[se]#[nl]#[sp]#[sp]#[sp]#[sp]return#[sp]"exit"#[se]#[nl]}#[nl]#[nl]if#[sp](#[sp]$cmd#[sp]eq#[sp]"Timer_off"#[sp]&&#[sp]ReadingsVal(#[sp]$name#[ko]#[sp]#[st]onHH#[st]#[ko]#[sp]#[st]00#[dp]00#[st]#[sp])#[sp]eq#[sp]"00#[dp]00"#[sp])#[sp]{#[nl]#[sp]#[sp]#[sp]#[sp]$cmd#[sp]=#[sp]"off"#[se]#[nl]}#[nl]#[nl]if#[sp](#[sp]$cmd#[sp]eq#[sp]"on"#[sp])#[sp]{#[nl]#[sp]#[sp]#[sp]#[sp]readingsSingleUpdate(#[sp]$hash#[ko]#[sp]"timer_state"#[ko]#[sp]"no_timer"#[ko]#[sp]1#[sp])#[se]#[nl]}#[nl]if#[sp](#[sp]$cmd#[sp]eq#[sp]"off"#[sp])#[sp]{#[nl]#[sp]#[sp]#[sp]#[sp]readingsSingleUpdate(#[sp]$hash#[ko]#[sp]"timer_state"#[ko]#[sp]"no_timer"#[ko]#[sp]1#[sp])#[se]#[nl]}#[nl]#[nl]if#[sp](#[sp]$cmd#[sp]eq#[sp]"onHH"#[sp])#[sp]{#[nl]#[sp]#[sp]#[sp]#[sp]readingsSingleUpdate(#[sp]$hash#[ko]#[sp]"onHH"#[ko]#[sp]$args[0]#[ko]#[sp]1#[sp])#[se]#[nl]#[sp]#[sp]#[sp]#[sp]return#[sp]"exit"#[se]#[nl]}#[nl]#[nl]if#[sp](#[sp]$cmd#[sp]eq#[sp]"Timer_on"#[sp]#[wa]#[wa]#[sp]$cmd#[sp]eq#[sp]"Timer_off"#[sp])#[sp]{#[nl]#[sp]#[sp]#[sp]#[sp]MSwitch_Delete_Delay(#[sp]$hash#[ko]#[sp]#[st]all#[st]#[sp])#[se]#[nl]#[nl]#[sp]#[sp]#[sp]#[sp]if#[sp](#[sp]$cmd#[sp]eq#[sp]"Timer_on"#[sp])#[sp]{#[nl]#[sp]#[sp]#[sp]#[sp]#[sp]#[sp]#[sp]#[sp]readingsSingleUpdate(#[sp]$hash#[ko]#[sp]"timer_state"#[ko]#[sp]"timed_on#[sp]"#[ko]#[sp]1#[sp])#[se]#[nl]#[nl]#[sp]#[sp]#[sp]#[sp]}#[nl]#[sp]#[sp]#[sp]#[sp]else#[sp]{#[nl]#[sp]#[sp]#[sp]#[sp]#[sp]#[sp]#[sp]#[sp]readingsSingleUpdate(#[sp]$hash#[ko]#[sp]"timer_state"#[ko]#[sp]"timed_off"#[ko]#[sp]1#[sp])#[se]#[nl]#[sp]#[sp]#[sp]#[sp]}#[nl]#[nl]#[sp]#[sp]#[sp]#[sp]my#[sp]@newtimer#[sp]=#[sp]split(#[sp]/#[dp]/#[ko]#[sp]ReadingsVal(#[sp]$name#[ko]#[sp]#[st]onHH#[st]#[ko]#[sp]#[st]00#[dp]01#[st]#[sp])#[sp])#[se]#[nl]#[sp]#[sp]#[sp]#[sp]$hh#[sp]=#[sp]$newtimer[0]#[sp]*#[sp]3600#[se]#[nl]#[sp]#[sp]#[sp]#[sp]$mm#[sp]=#[sp]$newtimer[1]#[sp]*#[sp]60#[se]#[nl]#[nl]#[sp]#[sp]#[sp]#[sp]my#[sp]$exectimer#[sp]=#[sp]time#[sp]+#[sp]$hh#[sp]+#[sp]$mm#[se]#[nl]#[nl]#[sp]#[sp]#[sp]#[sp]#my#[sp]$exectimer#[sp]=#[sp]time#[sp]+#[sp]10#[se]#[nl]#[nl]#[sp]#[sp]#[sp]#[sp]readingsSingleUpdate(#[sp]$hash#[ko]#[sp]"next_timer"#[ko]#[sp]$exectimer#[ko]#[sp]1#[sp])#[se]#[nl]#[nl]#[sp]#[sp]#[sp]#[sp]my#[sp]$msg#[sp]=#[sp]""#[se]#[nl]#[nl]#[sp]#[sp]#[sp]#[sp]if#[sp](#[sp]$cmd#[sp]eq#[sp]"Timer_on"#[sp])#[sp]{#[nl]#[sp]#[sp]#[sp]#[sp]#[sp]#[sp]#[sp]#[sp]$msg#[sp]=#[sp]"set#[sp]$name#[sp]on#[sp]#[tr]$name#[tr]#[tr]#[tr]$exectimer#[tr]"#[se]#[nl]#[sp]#[sp]#[sp]#[sp]}#[nl]#[sp]#[sp]#[sp]#[sp]else#[sp]{#[nl]#[sp]#[sp]#[sp]#[sp]#[sp]#[sp]#[sp]#[sp]$msg#[sp]=#[sp]"set#[sp]$name#[sp]off#[sp]#[tr]$name#[tr]#[tr]#[tr]$exectimer#[tr]"#[se]#[nl]#[sp]#[sp]#[sp]#[sp]}#[nl]#[nl]#[sp]#[sp]#[sp]#[sp]$hash->{helper}{delays}{$msg}#[sp]=#[sp]$exectimer#[se]#[nl]#[sp]#[sp]#[sp]#[sp]InternalTimer(#[sp]$exectimer#[ko]#[sp]"MSwitch_Restartcmd"#[ko]#[sp]$msg#[sp])#[se]#[nl]#[sp]#[sp]#[sp]#[sp]return#[sp]"exit"#[se]#[nl]}#[nl]
#S next_timer -> 1542553210.5749
#S .V_Check -> V2.00
#S  timer_state  -> timed_off
#S Trigger_device -> no_trigger
#S .Trigger_on -> no_trigger
#S Exec_cmd -> set renametest off 
#S timer_state  -> timed_off
#S .Device_Events -> no_trigger
#S .Device_Affected -> no_device
#S Sys_Extension -> on
#S .Trigger_off -> no_trigger
#S Trigger_log -> off
#S .First_init -> done
#S onHH -> 00:00
#S state -> off
#A MSwitch_Extensions -> 0
#A webCmdLabel -> :::Timer
#A MSwitch_Mode -> Full
#A MSwitch_Lock_Quickedit -> 1
#A MSwitch_Include_Devicecmds -> 1
#A devStateIcon -> { my $img = "<img src='/fhem/images/default/".ReadingsVal($name,'state','').".png'>"; return '<div>'.$img .'</div><div>'. ReadingsVal($name,"timer_state","").'</div>'}
#A MSwitch_Expert -> 0
#A MSwitch_Delete_Delays -> 1
#A webCmd -> Timer_on:Timer_off:Stop:onHH
#A MSwitch_Inforoom -> MSwitch
#A MSwitch_Help -> 0
#A MSwitch_Debug -> 0
#A MSwitch_Include_Webcmds -> 0
#A MSwitch_Include_MSwitchcmds -> 0
#A room -> MSwitch,1_test
#A MSwitch_Config -> MSw_Timer.conf
#A MSwitch_Ignore_Types -> notify allowed at watchdog doif fhem2fhem telnet FileLog readingsGroup FHEMWEB autocreate eventtypes readingsproxy svg cul
