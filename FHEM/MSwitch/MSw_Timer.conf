#V 2.03a_Test
#VS V2.00
#S .Trigger_cmd_on -> no_trigger
#S .Trigger_cmd_off -> no_trigger
#S Timer -> 02:05
#S .Device_Affected_Details -> t2-AbsCmd1#[NF]on#[NF]off#[NF]#[NF]#[NF]delay1#[NF]delay1#[NF]00:00:00#[NF]00:00:00#[NF]#[NF]#[NF]#[NF]#[NF]1#[NF]0
#S timer_state -> no_timer
#S .sysconf -> my#[sp]$hh#[sp]=#[sp]#[st]#[st]#[se]#[nl]my#[sp]$mm#[sp]=#[sp]#[st]#[st]#[se]#[nl]my#[sp]$x#[sp]#[sp]=#[sp]0#[se]#[nl]while#[sp](#[sp]$x#[sp]<#[sp]24#[sp])#[sp]{#[nl]#[sp]#[sp]#[sp]#[sp]my#[sp]$y#[sp]=#[sp]$x#[se]#[nl]#[sp]#[sp]#[sp]#[sp]if#[sp](#[sp]length($y)#[sp]<#[sp]2#[sp])#[sp]{#[sp]$y#[sp]=#[sp]"0"#[sp].#[sp]$y#[se]#[sp]}#[nl]#[sp]#[sp]#[sp]#[sp]$hh#[sp].=#[sp]$y#[sp].#[sp]"#[dp]00#[ko]"#[se]#[nl]#[sp]#[sp]#[sp]#[sp]my#[sp]$z#[sp]=#[sp]5#[se]#[nl]#[sp]#[sp]#[sp]#[sp]while#[sp](#[sp]$z#[sp]<#[sp]60#[sp])#[sp]{#[nl]#[sp]#[sp]#[sp]#[sp]#[sp]#[sp]#[sp]#[sp]my#[sp]$a#[sp]=#[sp]$z#[se]#[nl]#[sp]#[sp]#[sp]#[sp]#[sp]#[sp]#[sp]#[sp]if#[sp](#[sp]length($a)#[sp]<#[sp]2#[sp])#[sp]{#[sp]$a#[sp]=#[sp]"0"#[sp].#[sp]$a#[se]#[sp]}#[nl]#[sp]#[sp]#[sp]#[sp]#[sp]#[sp]#[sp]#[sp]$hh#[sp].=#[sp]$y#[sp].#[sp]"#[dp]"#[sp].#[sp]$a#[sp].#[sp]"#[ko]"#[se]#[nl]#[sp]#[sp]#[sp]#[sp]#[sp]#[sp]#[sp]#[sp]$z#[sp]=#[sp]$z#[sp]+#[sp]5#[se]#[nl]#[sp]#[sp]#[sp]#[sp]}#[nl]#[sp]#[sp]#[sp]#[sp]$x++#[se]#[nl]}#[nl]chop#[sp]$hh#[se]#[nl]$special#[sp]=#[sp]"onHH#[dp]"#[sp].#[sp]$hh#[se]#[nl]#[nl]if#[sp](#[sp]$cmd#[sp]eq#[sp]"Timer_on"#[sp]&&#[sp]ReadingsVal(#[sp]$name#[ko]#[sp]#[st]onHH#[st]#[ko]#[sp]#[st]00#[dp]00#[st]#[sp])#[sp]eq#[sp]"00#[dp]00"#[sp])#[sp]{#[nl]#[sp]#[sp]#[sp]#[sp]$cmd#[sp]=#[sp]"on"#[se]#[nl]}#[nl]#[nl]if#[sp](#[sp]$cmd#[sp]eq#[sp]"Stop"#[sp])#[sp]{#[nl]#[sp]#[sp]#[sp]#[sp]MSwitch_Delete_Delay(#[sp]$hash#[ko]#[sp]#[st]all#[st]#[sp])#[se]#[nl]#[sp]#[sp]#[sp]#[sp]readingsSingleUpdate(#[sp]$hash#[ko]#[sp]"timer_state"#[ko]#[sp]"no_timer"#[ko]#[sp]1#[sp])#[se]#[nl]#[sp]#[sp]#[sp]#[sp]return#[sp]"exit"#[se]#[nl]}#[nl]#[nl]if#[sp](#[sp]$cmd#[sp]eq#[sp]"Timer_off"#[sp]&&#[sp]ReadingsVal(#[sp]$name#[ko]#[sp]#[st]onHH#[st]#[ko]#[sp]#[st]00#[dp]00#[st]#[sp])#[sp]eq#[sp]"00#[dp]00"#[sp])#[sp]{#[nl]#[sp]#[sp]#[sp]#[sp]$cmd#[sp]=#[sp]"off"#[se]#[nl]}#[nl]#[nl]if#[sp](#[sp]$cmd#[sp]eq#[sp]"on"#[sp])#[sp]{#[nl]#[sp]#[sp]#[sp]#[sp]readingsSingleUpdate(#[sp]$hash#[ko]#[sp]"timer_state"#[ko]#[sp]"no_timer"#[ko]#[sp]1#[sp])#[se]#[nl]}#[nl]if#[sp](#[sp]$cmd#[sp]eq#[sp]"off"#[sp])#[sp]{#[nl]#[sp]#[sp]#[sp]#[sp]readingsSingleUpdate(#[sp]$hash#[ko]#[sp]"timer_state"#[ko]#[sp]"no_timer"#[ko]#[sp]1#[sp])#[se]#[nl]}#[nl]#[nl]if#[sp](#[sp]$cmd#[sp]eq#[sp]"onHH"#[sp])#[sp]{#[nl]#[sp]#[sp]#[sp]#[sp]readingsSingleUpdate(#[sp]$hash#[ko]#[sp]"onHH"#[ko]#[sp]$args[0]#[ko]#[sp]1#[sp])#[se]#[nl]#[sp]#[sp]#[sp]#[sp]return#[sp]"exit"#[se]#[nl]}#[nl]#[nl]if#[sp](#[sp]$cmd#[sp]eq#[sp]"Timer_on"#[sp]#[wa]#[wa]#[sp]$cmd#[sp]eq#[sp]"Timer_off"#[sp])#[sp]{#[nl]#[sp]#[sp]#[sp]#[sp]MSwitch_Delete_Delay(#[sp]$hash#[ko]#[sp]#[st]all#[st]#[sp])#[se]#[nl]#[nl]#[sp]#[sp]#[sp]#[sp]if#[sp](#[sp]$cmd#[sp]eq#[sp]"Timer_on"#[sp])#[sp]{#[nl]#[sp]#[sp]#[sp]#[sp]#[sp]#[sp]#[sp]#[sp]readingsSingleUpdate(#[sp]$hash#[ko]#[sp]"timer_state"#[ko]#[sp]"timed_on#[sp]"#[ko]#[sp]1#[sp])#[se]#[nl]#[nl]#[sp]#[sp]#[sp]#[sp]}#[nl]#[sp]#[sp]#[sp]#[sp]else#[sp]{#[nl]#[sp]#[sp]#[sp]#[sp]#[sp]#[sp]#[sp]#[sp]readingsSingleUpdate(#[sp]$hash#[ko]#[sp]"timer_state"#[ko]#[sp]"timed_off"#[ko]#[sp]1#[sp])#[se]#[nl]#[sp]#[sp]#[sp]#[sp]}#[nl]#[nl]#[sp]#[sp]#[sp]#[sp]my#[sp]@newtimer#[sp]=#[sp]split(#[sp]/#[dp]/#[ko]#[sp]ReadingsVal(#[sp]$name#[ko]#[sp]#[st]onHH#[st]#[ko]#[sp]#[st]00#[dp]01#[st]#[sp])#[sp])#[se]#[nl]#[sp]#[sp]#[sp]#[sp]$hh#[sp]=#[sp]$newtimer[0]#[sp]*#[sp]3600#[se]#[nl]#[sp]#[sp]#[sp]#[sp]$mm#[sp]=#[sp]$newtimer[1]#[sp]*#[sp]60#[se]#[nl]#[nl]#[sp]#[sp]#[sp]#[sp]my#[sp]$exectimer#[sp]=#[sp]time#[sp]+#[sp]$hh#[sp]+#[sp]$mm#[se]#[nl]#[nl]#[sp]#[sp]#[sp]#[sp]#my#[sp]$exectimer#[sp]=#[sp]time#[sp]+#[sp]10#[se]#[nl]#[nl]#[sp]#[sp]#[sp]#[sp]readingsSingleUpdate(#[sp]$hash#[ko]#[sp]"next_timer"#[ko]#[sp]$exectimer#[ko]#[sp]1#[sp])#[se]#[nl]#[nl]#[sp]#[sp]#[sp]#[sp]my#[sp]$msg#[sp]=#[sp]""#[se]#[nl]#[nl]#[sp]#[sp]#[sp]#[sp]if#[sp](#[sp]$cmd#[sp]eq#[sp]"Timer_on"#[sp])#[sp]{#[nl]#[sp]#[sp]#[sp]#[sp]#[sp]#[sp]#[sp]#[sp]$msg#[sp]=#[sp]"set#[sp]$name#[sp]on#[sp]#[tr]$name#[tr]#[tr]#[tr]$exectimer#[tr]"#[se]#[nl]#[sp]#[sp]#[sp]#[sp]}#[nl]#[sp]#[sp]#[sp]#[sp]else#[sp]{#[nl]#[sp]#[sp]#[sp]#[sp]#[sp]#[sp]#[sp]#[sp]$msg#[sp]=#[sp]"set#[sp]$name#[sp]off#[sp]#[tr]$name#[tr]#[tr]#[tr]$exectimer#[tr]"#[se]#[nl]#[sp]#[sp]#[sp]#[sp]}#[nl]#[nl]#[sp]#[sp]#[sp]#[sp]$hash->{helper}{delays}{$msg}#[sp]=#[sp]$exectimer#[se]#[nl]#[sp]#[sp]#[sp]#[sp]InternalTimer(#[sp]$exectimer#[ko]#[sp]"MSwitch_Restartcmd"#[ko]#[sp]$msg#[sp])#[se]#[nl]#[sp]#[sp]#[sp]#[sp]return#[sp]"exit"#[se]#[nl]}#[nl]
#S next_timer -> 1542553210.5749
#S .V_Check -> V2.00
#S  timer_state  -> timed_off
#S Trigger_device -> no_trigger
#S .Trigger_on -> no_trigger
#S Exec_cmd -> set renametest off 
#S timer_state  -> timed_off
#S .Device_Events -> no_trigger
#S .Device_Affected -> no_device
#S Sys_Extension -> on
#S .Trigger_off -> no_trigger
#S Trigger_log -> off
#S .First_init -> done
#S onHH -> 00:00
#S state -> off
#A MSwitch_Extensions -> 0
#A webCmdLabel -> :::Timer
#A MSwitch_Mode -> Full
#A MSwitch_Lock_Quickedit -> 1
#A MSwitch_Include_Devicecmds -> 1
#A devStateIcon -> { my $img = "<img src='/fhem/images/default/".ReadingsVal($name,'state','').".png'>"; return '<div>'.$img .'</div><div>'. ReadingsVal($name,"timer_state","").'</div>'}
#A MSwitch_Expert -> 0
#A MSwitch_Delete_Delays -> 1
#A webCmd -> Timer_on:Timer_off:Stop:onHH
#A MSwitch_Inforoom -> MSwitch
#A MSwitch_Help -> 0
#A MSwitch_Debug -> 0
#A MSwitch_Include_Webcmds -> 0
#A MSwitch_Include_MSwitchcmds -> 0
#A room -> MSwitch,1_test
#A MSwitch_Config -> MSw_Timer.conf
#A MSwitch_Ignore_Types -> notify allowed at watchdog doif fhem2fhem telnet FileLog readingsGroup FHEMWEB autocreate eventtypes readingsproxy svg cul
