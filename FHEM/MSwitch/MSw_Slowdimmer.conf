#V 2.61
#VS V2.00
#S EVTPART1 -> HUEGroup0
#S last_cmd -> 1
#S EVTFULL -> HUEGroup0:pct:0
#S .Trigger_cmd_off -> no_trigger
#S state -> active
#S intervall_percent -> 5
#S last_activation_by -> event
#S .Trigger_off -> no_trigger
#S akt_driving -> dimming_none
#S .Device_Affected -> FreeCmd-AbsCmd1,FreeCmd-AbsCmd2,FreeCmd-AbsCmd3,MSwitch_Self-AbsCmd1,MSwitch_Self-AbsCmd2,MSwitch_Self-AbsCmd3
#S EVTPART3 -> 0
#S EVENT -> pct:0
#S target_next -> 0
#S Trigger_device -> HUEGroup0
#S stop -> on
#S pct -> 0
#S .Device_Affected_Details -> FreeCmd-AbsCmd1#[NF]cmd#[NF]cmd#[NF]{;;my $device = "[$SELF:Trigger_device]";;;my $driving = "[$SELF:akt_driving]";;;my $targis = ReadingsNum($device,"pct","0"); ;;my $targsoll = "[$SELF:pct]";;;;;if ($targsoll eq $targis ) {$targsoll = "[$SELF:EVTPART3]";};;;;if ($targsoll eq $targis );;{;;readingsSingleUpdate( $hash, "akt_driving","dimming_none", 1 ) if $driving ne "dimming_none";;;};;;;readingsSingleUpdate( $hash, "target_is","$targis", 1 );;;;;Log3( "test", 0, "targis $targis" );;;Log3( "test", 0, "targsoll $targsoll" );;;;;;;my $step = "[$SELF:intervall_percent]";;;my $targ_cmd = AttrVal( "$SELF", 'setcmd', 'pct' ); ;;my $targnext = $targsoll;;;my $targerwartet = $targsoll;;;;;if ($targis < $targsoll);; {;;  $targnext = $targis+$step;;;  $targerwartet =$targnext+$step;;;  $targnext = $targsoll if $targnext > $targsoll;;;;;  readingsSingleUpdate( $hash, "akt_driving","dimming-up", 1 ) if $driving ne "dimming-up";;;;;;; };;elsif ($targis > $targsoll);; {;;  $targnext = $targis-$step;;;  $targerwartet =$targnext-$step;;;  $targnext = $targsoll if $targnext < $targsoll;;;;;  readingsSingleUpdate( $hash, "akt_driving","dimming-down", 1 ) if $driving ne "dimming-down";;; };;;;$targnext = 100 if $targnext > 100;;;$targnext = 0 if $targnext < 0;;;;;readingsSingleUpdate( $hash, "target_next","$targnext", 1 );;;readingsSingleUpdate( $hash, "target_ewrartet","$targerwartet ", 1 );;;fhem("set $device $targ_cmd $targnext") ;;;;;Log3( "test", 0, "set $device $targ_cmd $targnext" );;;Log3( "test", 0, "------------------" );;;;;;;return;;;}#[NF]#[NF]delay1#[NF]delay1#[NF]00:00:00#[NF]00:00:00#[NF]#[NF]#[NF]0#[NF]0#[NF]1#[NF]1#[NF]#[NF]0#[NF]0#[NF]1#[ND]FreeCmd-AbsCmd2#[NF]cmd#[NF]cmd#[NF]{;;fhem("set $SELF del_delays");;;readingsSingleUpdate( $hash, "pct","[$SELF:EVTPART3]", 1 );;;readingsSingleUpdate( $hash, "target_next","[$SELF:EVTPART3]", 1 );;;readingsSingleUpdate( $hash, "target_is","[$SELF:EVTPART3]", 1 );;;};;#[NF]#[NF]delay1#[NF]delay1#[NF]00:00:00#[NF]00:00:00#[NF][$SELF:target_next] ne [$SELF:EVTPART3] AND [$SELF:autostop] eq "on"#[NF]#[NF]0#[NF]0#[NF]1#[NF]2#[NF]#[NF]0#[NF]0#[NF]4#[ND]FreeCmd-AbsCmd3#[NF]cmd#[NF]cmd#[NF]{;;fhem("set $SELF del_delays") ;;;readingsSingleUpdate( $hash, "pct","[$SELF:target_next]", 1 );;;#readingsSingleUpdate( $hash, "target_next","[$SELF:EVTPART3]", 1 );;;readingsSingleUpdate( $hash, "target_is","[$SELF:target_next]", 1 );;;readingsSingleUpdate( $hash, "akt_driving","dimming_none", 1 );;;}#[NF]#[NF]delay1#[NF]delay1#[NF]00:00:00#[NF]00:00:00#[NF]#[NF]#[NF]0#[NF]0#[NF]1#[NF]3#[NF]#[NF]0#[NF]0#[NF]5#[ND]MSwitch_Self-AbsCmd1#[NF]exec_cmd_1#[NF]no_action#[NF]ID 1#[NF]#[NF]delay2#[NF]delay1#[NF][$SELF:intervall_time]#[NF]00:00:00#[NF][$SELF:target_is] ne [$SELF:pct]#[NF]#[NF]0#[NF]0#[NF]3#[NF]1#[NF]#[NF]0#[NF]0#[NF]3#[ND]MSwitch_Self-AbsCmd2#[NF]wait#[NF]no_action#[NF][$SELF:intervall_time]#[NF]#[NF]delay1#[NF]delay1#[NF]00:00:00#[NF]00:00:00#[NF][$SELF:autostop] eq "off"#[NF]#[NF]#[NF]#[NF]1#[NF]1#[NF]#[NF]0#[NF]0#[NF]1#[ND]MSwitch_Self-AbsCmd3#[NF]wait#[NF]no_action#[NF]0.5#[NF]#[NF]delay1#[NF]delay1#[NF]00:00:00#[NF]00:00:00#[NF][$SELF:autostop] eq "on"#[NF]#[NF]#[NF]#[NF]1#[NF]1#[NF]#[NF]0#[NF]0#[NF]1
#S target_is -> 0
#S intervall_time -> 00:00:02
#S .Trigger_on -> no_trigger
#S .sortby -> show
#S autostop -> off
#S stop.* -> 
#S EVTPART2 -> pct
#S .V_Check -> V2.00
#S target_ewrartet -> 0
#S .Trigger_condition -> "$EVENT"#[sp]=#[ti]#[sp]m/(pct#[pt]*)|(stop#[pt]*)/
#S Trigger_log -> off
#S .Device_Events -> no_trigger .*
#S .First_init -> done
#S .Trigger_time -> 
#S last_event -> pct:0
#S .Trigger_cmd_on -> .*
#A userattr -> setcmd
#A MSwitch_Lock_Quickedit -> 1
#A MSwitch_Event_Id_Distributor -> MSwitch_Self:pct:.*=>cmd1 ID 1#[nl]MSwitch_Self:stop.*=>cmd1 ID 3#[nl]^pct:.*=>cmd1 ID 2#[nl]
#A webCmd -> dimming-stop:pct:intervall_time:intervall_percent:autostop
#A MSwitch_Debug -> 0
#A MSwitch_Mode -> Notify
#A MSwitch_Extensions -> 0
#A MSwitch_Include_Devicecmds -> 1
#A MSwitch_Include_MSwitchcmds -> 0
